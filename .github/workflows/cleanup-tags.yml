name: Cleanup All Tags

on:
  workflow_dispatch:
    inputs:
      confirm_cleanup:
        description: 'T√ºm tag ve release i≈ülemlerini silmek i√ßin "DELETE" yazƒ±n'
        required: true
        default: ''

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Validate Confirmation
      if: github.event.inputs.confirm_cleanup != 'DELETE'
      run: |
        echo "‚ùå Hata: Silme i≈ülemini onaylamak i√ßin 'DELETE' yazmanƒ±z gerekiyor."
        echo "Girilen deƒüer: '${{ github.event.inputs.confirm_cleanup }}'"
        exit 1

    - name: Delete All Releases
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "üóëÔ∏è T√ºm release'ler siliniyor..."
        
        # Get all release IDs and delete them
        # Get all releases (limit 1000 should cover most cases)
        RELEASES=$(gh release list --limit 1000 --json tagName -q '.[].tagName' 2>/dev/null || echo "")
        
        if [ -z "$RELEASES" ]; then
          echo "üìù Silinecek release bulunamadƒ±."
        else
          echo "Bulunan release'ler:"
          echo "$RELEASES"
          echo ""
          
          for TAG in $RELEASES; do
            echo "Siliniyor: $TAG"
            # --cleanup-tag kullanmƒ±yoruz, tag silme i≈ülemi ayrƒ± adƒ±mda yapƒ±lacak
            gh release delete "$TAG" --yes 2>/dev/null || echo "  ‚ö†Ô∏è $TAG silinemedi (zaten silinmi≈ü olabilir)"
          done
          
          echo "‚úÖ T√ºm release'ler silindi."
        fi

    - name: Delete All Remote Tags
      run: |
        echo "üóëÔ∏è T√ºm uzak tag'ler siliniyor..."
        
        git fetch --tags --force
        
        # Get all tags
        TAGS=$(git tag -l)
        
        if [ -z "$TAGS" ]; then
          echo "üìù Silinecek tag bulunamadƒ±."
        else
          echo "Bulunan tag'ler:"
          echo "$TAGS"
          echo ""
          
          # Delete each tag from remote
          for TAG in $TAGS; do
            echo "Uzaktan siliniyor: $TAG"
            git push origin --delete "refs/tags/$TAG" 2>/dev/null || echo "  ‚ö†Ô∏è $TAG silinemedi (zaten silinmi≈ü olabilir)"
          done
          
          echo "‚úÖ T√ºm uzak tag'ler silindi."
        fi

    - name: Summary
      run: |
        echo ""
        echo "================================================"
        echo "‚úÖ TEMƒ∞ZLƒ∞K TAMAMLANDI"
        echo "================================================"
        echo ""
        
        # Doƒürulama: Kalan tag'leri kontrol et
        git fetch --tags --force
        REMAINING_TAGS=$(git tag -l | wc -l)
        
        if [ "$REMAINING_TAGS" -eq 0 ]; then
          echo "‚úÖ T√ºm tag'ler ba≈üarƒ±yla silindi."
        else
          echo "‚ö†Ô∏è Kalan tag sayƒ±sƒ±: $REMAINING_TAGS"
          echo "Kalan tag'ler:"
          git tag -l
        fi
        
        echo ""
        echo "Artƒ±k 'Build Android APK (Fresh)' workflow'u"
        echo "v1-0'dan temiz bir ba≈ülangƒ±√ß yapacak."
        echo ""
