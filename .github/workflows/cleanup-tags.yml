name: Cleanup All Tags

on:
  workflow_dispatch:
    inputs:
      confirm_cleanup:
        description: 'TÃ¼m tag ve release iÅŸlemlerini silmek iÃ§in "DELETE" yazÄ±n'
        required: true
        default: ''

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Validate Confirmation
      if: github.event.inputs.confirm_cleanup != 'DELETE'
      run: |
        echo "âŒ Hata: Silme iÅŸlemini onaylamak iÃ§in 'DELETE' yazmanÄ±z gerekiyor."
        echo "Girilen deÄŸer: '${{ github.event.inputs.confirm_cleanup }}'"
        exit 1

    - name: Delete All Releases
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "ğŸ—‘ï¸ TÃ¼m release'ler siliniyor..."
        
        # Get all release IDs and delete them
        RELEASES=$(gh release list --limit 100 --json tagName -q '.[].tagName' 2>/dev/null || echo "")
        
        if [ -z "$RELEASES" ]; then
          echo "ğŸ“ Silinecek release bulunamadÄ±."
        else
          echo "Bulunan release'ler:"
          echo "$RELEASES"
          echo ""
          
          for TAG in $RELEASES; do
            echo "Siliniyor: $TAG"
            gh release delete "$TAG" --yes --cleanup-tag 2>/dev/null || echo "  âš ï¸ $TAG silinemedi (zaten silinmiÅŸ olabilir)"
          done
          
          echo "âœ… TÃ¼m release'ler silindi."
        fi

    - name: Delete All Remote Tags
      run: |
        echo "ğŸ—‘ï¸ TÃ¼m uzak tag'ler siliniyor..."
        
        git fetch --tags --force
        
        # Get all tags
        TAGS=$(git tag -l)
        
        if [ -z "$TAGS" ]; then
          echo "ğŸ“ Silinecek tag bulunamadÄ±."
        else
          echo "Bulunan tag'ler:"
          echo "$TAGS"
          echo ""
          
          # Delete each tag from remote
          for TAG in $TAGS; do
            echo "Uzaktan siliniyor: $TAG"
            git push origin --delete "refs/tags/$TAG" 2>/dev/null || echo "  âš ï¸ $TAG silinemedi (zaten silinmiÅŸ olabilir)"
          done
          
          echo "âœ… TÃ¼m uzak tag'ler silindi."
        fi

    - name: Summary
      run: |
        echo ""
        echo "================================================"
        echo "âœ… TEMÄ°ZLÄ°K TAMAMLANDI"
        echo "================================================"
        echo ""
        echo "TÃ¼m tag'ler ve release'ler baÅŸarÄ±yla silindi."
        echo "ArtÄ±k 'Build Android APK (Fresh)' workflow'u"
        echo "v1-0'dan temiz bir baÅŸlangÄ±Ã§ yapacak."
        echo ""
